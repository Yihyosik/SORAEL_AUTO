<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Soraiel Chat</title>
  <style>
    :root {
      --bg-primary: #F8F9FA;
      --bg-secondary: #FFFFFF;
      --bg-user: #F8F9FA;
      --bg-assistant: #FFFFFF;
      --text-primary: #1F1F1F;
      --text-secondary: #656B73;
      --border-light: #E6E8EB;
      --accent-orange: #D97706;
      --accent-blue: #0066CC;
      --shadow-light: 0 1px 3px rgba(0,0,0,0.1);
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg-primary); color: var(--text-primary); font-size: 15px; line-height: 1.6; }
    body { display: flex; flex-direction: column; }

    /* 상단 헤더 */
    .header { background-color: var(--bg-secondary); border-bottom: 1px solid var(--border-light); padding: 16px 20px; display: flex; align-items: center; justify-content: center; position: relative; box-shadow: var(--shadow-light); }
    .header-title { font-size: 16px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
    .header-icon { width: 20px; height: 20px; background: linear-gradient(135deg, var(--accent-orange), #F59E0B); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold; }

    /* 채팅 영역 */
    .chat-container { flex: 1; overflow-y: auto; background-color: var(--bg-primary); }
    .chat { max-width: 800px; margin: 0 auto; padding: 20px; display: flex; flex-direction: column; gap: 32px; }
    .message-group { display: flex; flex-direction: column; gap: 4px; }
    .message-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }

    .avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
    .user-avatar { background: var(--accent-blue); color: white; }
    .bot-avatar { background: linear-gradient(135deg, var(--accent-orange), #F59E0B); color: white; }
    .sender-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }

    .message-content { background-color: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: 12px; padding: 16px 20px; margin-left: 36px; box-shadow: var(--shadow-light); position: relative; }
    .message-content::before { content: ''; position: absolute; left: -37px; top: 12px; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-right: 6px solid var(--border-light); }
    .message-content::after { content: ''; position: absolute; left: -36px; top: 12px; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-right: 6px solid var(--bg-secondary); }
    .message-text { color: var(--text-primary); white-space: pre-wrap; word-wrap: break-word; }

    /* 입력 영역 */
    .input-container { background-color: var(--bg-secondary); border-top: 1px solid var(--border-light); padding: 16px 20px; flex-shrink: 0; }
    .input-wrapper { max-width: 800px; margin: 0 auto; }
    .input-bar { display: flex; align-items: flex-end; gap: 12px; background-color: var(--bg-primary); border: 2px solid var(--border-light); border-radius: 24px; padding: 8px; }
    .input-bar:focus-within { border-color: var(--accent-orange); }
    .input-bar textarea { flex: 1; border: none; background: transparent; color: var(--text-primary); font-size: 15px; font-family: inherit; line-height: 1.4; resize: none; outline: none; padding: 8px 12px; max-height: 120px; min-height: 24px; }
    .send-button { width: 32px; height: 32px; border: none; border-radius: 50%; background: var(--accent-orange); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; }

    /* 로딩 인디케이터 */
    .typing-indicator { display: flex; align-items: center; gap: 8px; margin-left: 36px; padding: 12px 20px; color: var(--text-secondary); font-size: 14px; }
    .typing-dots { display: flex; gap: 4px; }
    .typing-dot { width: 4px; height: 4px; background-color: var(--accent-orange); border-radius: 50%; animation: typing-pulse 1.4s infinite ease-in-out; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing-pulse { 0%, 80%, 100% { opacity: 0.3; transform: scale(0.8);} 40% { opacity: 1; transform: scale(1);} }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-title">
      <div class="header-icon">S</div>
      Soraiel
    </div>
  </div>

  <div class="chat-container" id="chatContainer">
    <div class="chat" id="chat">
      <div class="message-group">
        <div class="message-header">
          <div class="avatar bot-avatar">S</div>
          <span class="sender-name">Soraiel</span>
        </div>
        <div class="message-content">
          <div class="message-text">안녕하세요, 저는 Soraiel입니다. 무엇을 도와드릴까요?</div>
        </div>
      </div>
    </div>
  </div>

  <div class="input-container">
    <div class="input-wrapper">
      <div class="input-bar">
        <textarea id="messageInput" placeholder="메시지를 입력하세요..." rows="1"></textarea>
        <button class="send-button" id="sendButton">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M15.854 7.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708L14.293 8.5H.5a.5.5 0 0 1 0-1h13.793L8.146 1.354a.5.5 0 0 1 .708-.708l7 7z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

<script>
const chat = document.getElementById('chat');
const chatContainer = document.getElementById('chatContainer');
const messageInput = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');

const API_BASE = "https://soraiel-server.onrender.com"; // ✅ API 서버 주소

function adjustTextareaHeight() {
  messageInput.style.height = 'auto';
  messageInput.style.height = Math.min(messageInput.scrollHeight, 120) + 'px';
  sendButton.disabled = !messageInput.value.trim();
}

function addMessage(text, isUser = false) {
  const messageGroup = document.createElement('div');
  messageGroup.className = 'message-group';
  const messageHeader = document.createElement('div');
  messageHeader.className = 'message-header';
  const avatar = document.createElement('div');
  avatar.className = `avatar ${isUser ? 'user-avatar' : 'bot-avatar'}`; // ✅ 수정됨
  avatar.textContent = isUser ? 'U' : 'S';
  const senderName = document.createElement('span');
  senderName.className = 'sender-name';
  senderName.textContent = isUser ? 'You' : 'Soraiel';
  messageHeader.appendChild(avatar);
  messageHeader.appendChild(senderName);
  const messageContent = document.createElement('div');
  messageContent.className = 'message-content';
  const messageText = document.createElement('div');
  messageText.className = 'message-text';
  messageText.textContent = text;
  messageContent.appendChild(messageText);
  messageGroup.appendChild(messageHeader);
  messageGroup.appendChild(messageContent);
  chat.appendChild(messageGroup);
  scrollToBottom();
}

function showTypingIndicator() {
  const typingDiv = document.createElement('div');
  typingDiv.className = 'typing-indicator';
  typingDiv.id = 'typing';
  const botAvatar = document.createElement('div');
  botAvatar.className = 'avatar bot-avatar';
  botAvatar.textContent = 'S';
  const textSpan = document.createElement('span');
  textSpan.textContent = 'Soraiel이 입력 중';
  const typingDots = document.createElement('div');
  typingDots.className = 'typing-dots';
  for (let i = 0; i < 3; i++) {
    const dot = document.createElement('div');
    dot.className = 'typing-dot';
    typingDots.appendChild(dot);
  }
  typingDiv.appendChild(botAvatar);
  typingDiv.appendChild(textSpan);
  typingDiv.appendChild(typingDots);
  chat.appendChild(typingDiv);
  scrollToBottom();
}

function hideTypingIndicator() {
  const typing = document.getElementById('typing');
  if (typing) typing.remove();
}

function scrollToBottom() {
  chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
}

async function sendMessage() {
  const userMessage = messageInput.value.trim();
  if (!userMessage) return;
  addMessage(userMessage, true);
  messageInput.value = '';
  adjustTextareaHeight();
  showTypingIndicator();
  try {
    const response = await fetch(`${API_BASE}/chat`, {  // ✅ 절대 경로로 변경
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: userMessage })
    });
    const result = await response.json();
    hideTypingIndicator();
    addMessage(result.response, false);
  } catch (err) {
    hideTypingIndicator();
    addMessage('오류가 발생했습니다. AI 응답을 가져올 수 없습니다.', false);
  }
}

sendButton.addEventListener('click', sendMessage);
messageInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
messageInput.addEventListener('input', adjustTextareaHeight);
window.addEventListener('load', scrollToBottom);
</script>
</body>
</html>
